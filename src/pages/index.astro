---
import BaseLayout from '../layouts/BaseLayout.astro';
import { loadPage } from '../lib/content.ts';
import Hero from '../components/Hero.astro';
import CTA from '../components/CTA.astro';
import ImageCard from '../components/ImageCard.astro';
import SectionHeader from '../components/SectionHeader.astro';

const slug = 'index';
const page = await loadPage(slug);
const fallbackTitle = 'Freaky Flyer Delivery';
const fallbackDescription = 'GPS-verified flyer delivery in Perth.';
const frontmatter = page?.fm ?? {};
const rawTitle = typeof frontmatter.title === 'string' ? frontmatter.title : '';
const rawDescription =
  typeof frontmatter.description === 'string' ? frontmatter.description : '';
const title = rawTitle.trim().length > 0 ? rawTitle : fallbackTitle;
const description =
  rawDescription.trim().length > 0 ? rawDescription : fallbackDescription;
const heroImage = '/assets/brand/nw01ffd_home_banner.jpg';
const aboutPanelImage = '/assets/img/optimized/about-us/about-hero.jpg';
const flyerTipsPanelImage = '/assets/img/optimized/flyer-tips/tips-hero.jpg';
const whyImage = '/assets/img/optimized/index/ffdwarehousepersonell-960.webp';
---

<BaseLayout {title} description={description}>
  <Hero
    image={heroImage}
    kicker="Family owned. Perth proud."
    title="Perth's specialists in flyer, brochure & pamphlet delivery"
    text="Full GPS tracking on every delivery so you can see exactly where your flyers go."
  >
    <div slot="actions">
      <button
        type="button"
        class="button primary"
        data-modal-open="video-modal"
      >
        Watch Our Video
      </button>
      <a class="button outline" href="/pricing">View Pricing</a>
    </div>
  </Hero>

  <section aria-labelledby="intro-heading" class="section intro">
    <div class="container intro__container">
      <h2 id="intro-heading">Professional flyer distribution across Perth</h2>
      <p>
        We are a family-owned and operated flyer delivery business specialising
        in distributing flyers to residential homes across the Perth
        metropolitan area. Our full-time riders deliver an honest, reliable and
        accountable service for every campaign.
      </p>
    </div>
  </section>

  <section class="section discover">
    <div class="container">
      <SectionHeader title="Discover how we support your campaigns" />
      <div class="grid cols-2 discover__grid">
        <ImageCard
          image={aboutPanelImage}
          title="About Us"
          text="Meet the family-run team behind Freaky Flyer Delivery and see how we built Perth’s most accountable flyer network."
          href="/about"
        />
        <ImageCard
          image={flyerTipsPanelImage}
          title="Flyer Tips"
          text="Sharpen every drop with proven creative, sizing and follow-up advice from our delivery specialists."
          href="/flyer-tips"
          tone="dark"
        />
      </div>
    </div>
  </section>

  <section aria-labelledby="pricing-heading" class="section pricing-highlight">
    <div class="container pricing-highlight__inner">
      <p class="badge pricing-highlight__badge">
        Residential letterbox distribution &amp; flyer delivery
      </p>
      <h2 id="pricing-heading">From as low as</h2>
      <p class="pricing-highlight__price">
        $85.00*
        <span>per 1,000 homes (inc GST)</span>
      </p>
      <p class="pricing-highlight__note">
        *Conditions apply – ask our friendly staff for details.
      </p>
      <a class="button button--inverted pricing-highlight__cta" href="/pricing"
        >View Pricing</a
      >
    </div>
  </section>

  <section aria-labelledby="why-heading" class="section why">
    <div class="container why__layout">
      <figure class="why__media">
        <img
          src={whyImage}
          alt="Freaky Flyer Delivery team standing in the warehouse"
          loading="lazy"
          width="640"
          height="728"
        />
      </figure>
      <div class="why__content">
        <h2 id="why-heading">Why choose Freaky Flyer Delivery?</h2>
        <ol class="why__list">
          <li class="why__item">
            <span class="why__number">1</span>
            <div>
              <h3>Unique EQUALIZING Technique Ensures Maximum Exposure</h3>
              <p>
                Our preparation and Equalizing team layer all flyers for a
                particular delivery suburb or area, one on top of the other in
                preparation for the delivery. This ensures that when they are
                put into the householders letterbox the flyers will spread out
                creating maximum exposure for all of our clients. We also vary
                the order of the flyers, creating even greater equal exposure
                for all of our clients on each individual delivery.
              </p>
            </div>
          </li>
          <li class="why__item">
            <span class="why__number">2</span>
            <div>
              <h3>
                Tried &amp; Tested Delivery Method Ensures Maximum Efficiency
              </h3>
              <p>
                Our tried and tested method of delivery, undertaking delivery on
                ex Australia Post Honda CT110 motorbikes, with waterproof rear
                side pannier bags, maximizing our riders efficiency, and
                ensuring delivery of dry flyers even in the worst winter weather
                Perth can produce.
              </p>
            </div>
          </li>
          <li class="why__item">
            <span class="why__number">3</span>
            <div>
              <h3>Full GPS Tracking gives you complete confidence</h3>
              <p>
                Our Equalizing technique increases the exposure to the
                householder for all of our clients. Having a smaller client base
                than our competitors generally means most likely only having
                two-three additional flyers for delivery, significantly
                increasing the share of exposure on each delivery.
              </p>
            </div>
          </li>
        </ol>
      </div>
    </div>
  </section>

  <CTA
    title="We look forward to working with you"
    body="Contact our friendly sales team for a tailored quote and delivery schedule."
    actionLabel="Contact Us"
    actionHref="/contact"
  />

  <dialog
    id="video-modal"
    class="video-modal"
    aria-labelledby="video-modal-heading"
  >
    <div class="video-modal__inner">
      <header class="video-modal__header">
        <h2 id="video-modal-heading">Freaky Flyer Delivery overview</h2>
        <button
          type="button"
          class="video-modal__close"
          data-modal-close
          aria-label="Close video"
        >
          &times;
        </button>
      </header>
      <div class="video-modal__body">
        <iframe
          src="https://www.youtube.com/embed/yqOR6wtYyjQ"
          title="Freaky Flyer Delivery overview video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
          loading="lazy"></iframe>
      </div>
    </div>
  </dialog>

  <script type="module">
    const modal = document.getElementById('video-modal');
    const triggers = document.querySelectorAll(
      '[data-modal-open="video-modal"]'
    );

    if (modal instanceof HTMLDialogElement) {
      const closeButton = modal.querySelector('[data-modal-close]');
      const iframe = modal.querySelector('iframe');

      const stopVideo = () => {
        if (iframe && iframe instanceof HTMLIFrameElement) {
          const src = iframe.getAttribute('src');
          if (src) {
            iframe.setAttribute('src', src);
          }
        }
      };

      const openModal = () => {
        if (!modal.open) {
          modal.showModal();
        }
      };

      const closeModal = () => {
        if (modal.open) {
          modal.close();
        }
      };

      triggers.forEach((trigger) => {
        trigger.addEventListener('click', (event) => {
          event.preventDefault();
          openModal();
        });
      });

      modal.addEventListener('close', () => {
        stopVideo();
      });

      modal.addEventListener('cancel', (event) => {
        event.preventDefault();
        closeModal();
      });

      modal.addEventListener('click', (event) => {
        const rect = modal.getBoundingClientRect();
        const isInDialog =
          event.clientX >= rect.left &&
          event.clientX <= rect.right &&
          event.clientY >= rect.top &&
          event.clientY <= rect.bottom;

        if (!isInDialog) {
          closeModal();
        }
      });

      if (closeButton instanceof HTMLButtonElement) {
        closeButton.addEventListener('click', () => {
          closeModal();
        });
      }
    }
  </script>

  <style>
    .intro {
      background: #fff;
      text-align: center;
    }

    .intro__container {
      max-width: 70ch;
      margin: 0 auto;
    }

    .intro__container p {
      font-size: 1.05rem;
      line-height: 1.8;
    }

    .discover {
      background: var(--surface);
    }

    .discover__grid {
      align-items: stretch;
    }

    .pricing-highlight {
      background: var(--accent);
      color: #fff;
      text-align: center;
    }

    .pricing-highlight__badge {
      display: inline-block;
      margin-bottom: var(--space-4);
      background: rgba(255, 255, 255, 0.12);
      color: #fff;
      padding: 6px 18px;
      border-radius: 999px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .pricing-highlight h2 {
      color: #fff;
      margin-bottom: var(--space-2);
    }

    .pricing-highlight__price {
      font-size: clamp(3rem, 8vw, 4.5rem);
      margin: 0 0 var(--space-2);
      font-weight: 800;
    }

    .pricing-highlight__price span {
      display: block;
      font-size: clamp(1rem, 2.5vw, 1.2rem);
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-top: var(--space-2);
    }

    .pricing-highlight__note {
      margin-bottom: var(--space-6);
      font-size: 0.95rem;
    }

    .why__layout {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: var(--space-8);
      align-items: center;
    }

    .why__media img {
      width: 100%;
      height: auto;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .why__content h2 {
      margin-bottom: var(--space-6);
    }

    .why__list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: var(--space-6);
    }

    .why__item {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: var(--space-4);
      align-items: start;
    }

    .why__number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      font-weight: 800;
      font-size: 1.2rem;
    }

    .video-modal {
      border: none;
      border-radius: 20px;
      padding: 0;
      max-width: min(960px, 90vw);
      width: 100%;
      box-shadow: 0 30px 70px rgba(15, 23, 42, 0.35);
      background: #0f172a;
      color: #fff;
    }

    .video-modal::backdrop {
      background: rgba(15, 23, 42, 0.75);
    }

    .video-modal__inner {
      display: grid;
      gap: 0;
    }

    .video-modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-4) var(--space-6);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .video-modal__close {
      font-size: 2rem;
      background: transparent;
      border: none;
      color: #fff;
      cursor: pointer;
    }

    .video-modal__body {
      padding: 0;
      aspect-ratio: 16 / 9;
    }

    .video-modal__body iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    @media (max-width: 900px) {
      .why__layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</BaseLayout>
