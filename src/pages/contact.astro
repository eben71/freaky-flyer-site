---
import BaseLayout from "../layouts/BaseLayout.astro";
import { loadPage } from "../lib/content.ts";
import SectionHeader from "../components/SectionHeader.astro";
import ContentBlock from "./_partials/ContentBlock.astro";
import { site } from "../site.config";
import { linkAttrs } from "../lib/links";

const slug = "contact";
const page = await loadPage(slug);
const fallbackTitle = "Contact";
const fallbackDescription = "Start your next flyer campaign with Freaky Flyer Delivery.";
const frontmatter = page?.fm ?? {};
const rawTitle = typeof frontmatter.title === "string" ? frontmatter.title : "";
const rawDescription = typeof frontmatter.description === "string" ? frontmatter.description : "";
const title = rawTitle.trim().length > 0 ? rawTitle : fallbackTitle;
const description = rawDescription.trim().length > 0 ? rawDescription : fallbackDescription;
const telHref = `tel:${site.phone.replace(/[^\d+]/g, "")}`;
const emailHref = `mailto:${site.email}`;
const telAttrs = linkAttrs(telHref);
const emailAttrs = linkAttrs(emailHref);
const mapPlaceholderLabel = "Warehouse map placeholder";
---
<BaseLayout {title} description={description}>
  <section class="section surface">
    <div class="container">
      <SectionHeader title="Contact Us" />
      <div class="contact-layout">
        <div class="contact-form">
          <p class="contact-intro">
            Ready to launch your next drop? Share a few details and we’ll confirm suburb coverage, timing, and bundle quantities.
          </p>
          <div class="contact-banner" role="status" hidden>
            <strong>Thanks!</strong> We’ll wire this up next.
          </div>
          <form id="contact-request" novalidate>
            <input type="text" name="company" tabindex="-1" autocomplete="off" class="contact-honeypot" />
            <div class="form-grid">
              <label>
                <span>Name</span>
                <input type="text" name="name" autocomplete="name" required />
              </label>
              <label>
                <span>Email</span>
                <input type="email" name="email" autocomplete="email" required />
              </label>
              <label>
                <span>Phone (optional)</span>
                <input type="tel" name="phone" autocomplete="tel" />
              </label>
              <label class="form-full">
                <span>Message</span>
                <textarea name="message" rows="5" placeholder="Tell us about your campaign goals" required></textarea>
              </label>
            </div>
            <div class="form-actions">
              <button type="submit" class="button primary" disabled>Send Message</button>
            </div>
          </form>
        </div>
        <aside class="contact-sidebar">
          <div class="contact-card">
            <h3>Talk to the team</h3>
            <ul>
              <li>
                <strong>Phone:</strong>
                <a href={telHref} {...telAttrs}>{site.phone}</a>
              </li>
              <li>
                <strong>Email:</strong>
                <a href={emailHref} {...emailAttrs}>{site.email}</a>
              </li>
              <li>
                <strong>Warehouse:</strong>
                <span>{site.address}</span>
              </li>
              <li>
                <strong>Hours:</strong>
                <span>{site.hours}</span>
              </li>
            </ul>
          </div>
          <div class="contact-card">
            <h3>Warehouse Map</h3>
            <div class="contact-map" role="img" aria-label={mapPlaceholderLabel}>
              <span>Map artwork arriving soon</span>
            </div>
            <p class="muted">Interactive map integration arrives in the next release.</p>
          </div>
        </aside>
      </div>
    </div>
  </section>

  {page && <ContentBlock html={page.html} />}

  <script type="module">
    const form = document.getElementById('contact-request');
    const banner = document.querySelector('.contact-banner');
    const submit = form?.querySelector('button[type="submit"]');

    const toggleButton = () => {
      if (!(form instanceof HTMLFormElement) || !(submit instanceof HTMLButtonElement)) {
        return;
      }
      const formData = new FormData(form);
      const hasName = (formData.get('name') || '').toString().trim().length > 0;
      const hasEmail = (formData.get('email') || '').toString().trim().length > 0;
      const hasMessage = (formData.get('message') || '').toString().trim().length > 0;
      submit.disabled = !(hasName && hasEmail && hasMessage);
    };

    if (form instanceof HTMLFormElement && submit instanceof HTMLButtonElement) {
      form.addEventListener('input', toggleButton);
      form.addEventListener('submit', (event) => {
        event.preventDefault();
        toggleButton();
        if (banner instanceof HTMLElement) {
          banner.hidden = false;
        }
      });
      toggleButton();
    }
  </script>

  <style>
    .contact-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
      gap: var(--space-8);
      align-items: start;
    }

    .contact-form {
      display: grid;
      gap: var(--space-4);
    }

    .contact-intro {
      font-size: 1.05rem;
      line-height: 1.7;
    }

    .contact-banner {
      background: rgba(137, 4, 11, 0.12);
      border-left: 4px solid var(--accent);
      padding: var(--space-3) var(--space-4);
      border-radius: 10px;
      color: var(--accent);
      font-weight: 600;
    }

    .contact-honeypot {
      position: absolute;
      left: -9999px;
      opacity: 0;
      height: 0;
      width: 0;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: var(--space-4);
    }

    .form-full {
      grid-column: 1 / -1;
    }

    label {
      display: grid;
      gap: var(--space-2);
      font-weight: 600;
      color: var(--fg);
    }

    input,
    textarea {
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #d7dce5;
      font: inherit;
      background: #fff;
    }

    input:focus-visible,
    textarea:focus-visible {
      outline: 3px solid var(--ring);
      outline-offset: 2px;
    }

    textarea {
      resize: vertical;
      min-height: 140px;
    }

    .form-actions {
      margin-top: var(--space-4);
    }

    .contact-sidebar {
      display: grid;
      gap: var(--space-4);
    }

    .contact-card {
      background: #fff;
      border-radius: var(--radius);
      padding: var(--space-4);
      box-shadow: var(--shadow);
      display: grid;
      gap: var(--space-3);
    }

    .contact-card ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: grid;
      gap: var(--space-2);
    }

    .contact-map {
      border-radius: var(--radius);
      width: 100%;
      aspect-ratio: 4 / 3;
      display: grid;
      place-items: center;
      background: repeating-linear-gradient(
          -45deg,
          rgba(137, 4, 11, 0.18),
          rgba(137, 4, 11, 0.18) 12px,
          rgba(0, 0, 0, 0.08) 12px,
          rgba(0, 0, 0, 0.08) 24px
        ),
        #f1f2f6;
      color: var(--accent-600);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      text-align: center;
      padding: var(--space-4);
    }

    @media (max-width: 900px) {
      .contact-layout {
        grid-template-columns: 1fr;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</BaseLayout>
